<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SmartHome â€¢ Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

  <div class="container">

    <div class="topbar">
      <div class="brand">
        <span class="dot"></span>
        <span>SmartHome Admin</span>
      </div>

      <div class="userchip">
        <span class="badge">Xin chÃ o <b>{{user}}</b></span>
        <span class="badge">Vai trÃ²: <b>{{role}}</b></span>
      </div>
    </div>

    <div class="grid">

      <!-- LEFT: Actions -->
      <div class="card">
        <h3>Äiá»u khiá»ƒn nhanh</h3>
        <p>Báº¥m Ä‘á»ƒ gá»­i lá»‡nh Ä‘iá»u khiá»ƒn. Tráº¡ng thÃ¡i sáº½ tá»± cáº­p nháº­t má»—i giÃ¢y.</p>

        <div style="height:14px"></div>

        <div class="actions">
          <button class="btn btn-primary" onclick="door()">ğŸšª Open Door</button>
          <button class="btn btn-soft" onclick="light('ON')">ğŸ’¡ Light ON</button>
          <button class="btn btn-ghost" onclick="light('OFF')">ğŸ’¡ Light OFF</button>
        </div>

        <div style="height:16px"></div>

        <div class="state">
          <div>
            <div class="label">Device status</div>
            <div class="value" id="state">--</div>
          </div>
          <div class="badge">Auto refresh: 1s</div>
        </div>

       
      </div>

      <!-- RIGHT: Navigation -->
      <div class="card">
        <h3>Äiá»u hÆ°á»›ng</h3>
        <p>Chuyá»ƒn nhanh tá»›i cÃ¡c trang quáº£n trá»‹.</p>

        <div class="nav">
          {% if role=="admin" %}
            <a href="/users">ğŸ‘¤ Manage Users</a>
          {% endif %}
          <a href="/logs">ğŸ“œ Logs</a>
          <a href="/logout">ğŸšª Logout</a>
        </div>
      </div>

    </div>
  </div>

  <script>
    async function door(){
      await fetch("/door",{method:"POST"})
    }
    async function light(s){
      await fetch("/light",{
        method:"POST",
        headers:{"Content-Type":"application/x-www-form-urlencoded"},
        body:"state="+encodeURIComponent(s)
      })
    }

    async function update(){
      let r = await fetch("/status");
      let d = await r.json();
      document.getElementById("state").innerText = "Device: " + d.result;
    }

    update();
    setInterval(update, 1000);
  </script>

</body>
</html>
